<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Valentine‚Äôs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script src="https://w.soundcloud.com/player/api.js"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; overflow:hidden; font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif; }
canvas { position:fixed; inset:0; z-index:0; }

/* UI Card */
.container {
  position:relative; z-index:2;
  display:flex; justify-content:center; align-items:center; height:100%;
  perspective:1300px;
}

.card {
  width:380px; padding:36px;
  background:rgba(255,255,255,0.18); backdrop-filter:blur(26px);
  border-radius:30px; box-shadow:0 28px 90px rgba(0,0,0,0.28);
  text-align:center; color:white; transform-style:preserve-3d;
}

h1 { font-size:32px; margin-bottom:8px; }
p { font-size:18px; opacity:0.95; }

#countdown { margin:14px 0 22px; font-size:16px; }

.buttons { position:relative; height:75px; }
button {
  position:absolute; padding:14px 32px; font-size:16px;
  border:none; border-radius:999px; cursor:pointer;
  transition:transform .25s ease;
}
.yes { left:0; background:white; color:#ff4d6d; }
.no { right:0; background:transparent; color:white; border:2px solid rgba(255,255,255,0.85); }

/* Trail hearts */
.trail {
  position:fixed; pointer-events:none; font-size:14px;
  animation:fade 1s forwards;
}
@keyframes fade { to { opacity:0; transform:translateY(-30px) scale(1.4);} }
</style>
</head>

<body>

<canvas id="gl"></canvas>

<div class="container">
  <div class="card" id="card">
    <h1>Heyyy HEERIKA JAIN ‚ù§Ô∏è</h1>
    <p>Will you be my Valentine?</p>
    <div id="countdown"></div>
    <div class="buttons">
      <button class="yes" id="yesBtn">YESSSSSS!! üíñ</button>
      <button class="no" id="noBtn">No üòî</button>
    </div>
  </div>
</div>

<!-- Offscreen SoundCloud Widget -->
<iframe id="sc" 
  style="display:none;" 
  src="https://w.soundcloud.com/player/?url=https%3A//on.soundcloud.com/WQUcmetMLylZnxs7qw&auto_play=false&hide_related=true&show_comments=false&visual=false">
</iframe>

<audio id="music"></audio>

<script>
// ========== WEBGL + AUDIO REACTIVE SHADER ==========

const canvas = document.getElementById("gl");
const gl = canvas.getContext("webgl");
canvas.width = innerWidth; canvas.height = innerHeight;

// Vertex Shader
const vert = `
attribute vec2 position;
void main(){ gl_Position = vec4(position, 0., 1.); }
`;

// Fragment Shader (reacts to music amplitude)
const frag = `
precision highp float;
uniform vec2 resolution;
uniform vec2 mouse;
uniform float time;
uniform float audioLevel;

void main(){
  vec2 uv = (gl_FragCoord.xy - 0.5 * resolution) / resolution.y;

  float dist = length(uv);
  float ripple = sin((dist - time * 0.8)*10.0 + audioLevel*12.0);

  vec3 base = mix(vec3(0.9,0.3,0.5), vec3(0.5,0.1,0.8), dist);
  float glow = smoothstep(0.65, 0.0, dist);
  vec3 color = base + ripple * 0.14 * glow;

  gl_FragColor = vec4(color, 1.0);
}
`;

function compile(type, source) {
  const s = gl.createShader(type);
  gl.shaderSource(s, source);
  gl.compileShader(s);
  return s;
}

const program = gl.createProgram();
gl.attachShader(program, compile(gl.VERTEX_SHADER, vert));
gl.attachShader(program, compile(gl.FRAGMENT_SHADER, frag));
gl.linkProgram(program);
gl.useProgram(program);

const buffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
  -1, -1, 1, -1, -1, 1, 1, 1
]), gl.STATIC_DRAW);

const posAttrib = gl.getAttribLocation(program, "position");
gl.enableVertexAttribArray(posAttrib);
gl.vertexAttribPointer(posAttrib, 2, gl.FLOAT, false, 0, 0);

const uRes = gl.getUniformLocation(program, "resolution");
const uTime = gl.getUniformLocation(program, "time");
const uMouse = gl.getUniformLocation(program, "mouse");
const uAudio = gl.getUniformLocation(program, "audioLevel");

let mousePos = [0,0];
window.addEventListener("mousemove", e => {
  mousePos = [(e.clientX / innerWidth)*2.0-1.0, (e.clientY / innerHeight)*2.0-1.0];
});
window.addEventListener("touchmove", e => {
  mousePos = [(e.touches[0].clientX / innerWidth)*2.0-1.0, (e.touches[0].clientY / innerHeight)*2.0-1.0];
});

// SoundCloud widget + Web Audio API
const scFrame = document.getElementById("sc");
const widget = SC.Widget(scFrame);

const audioCtx = new AudioContext();
const analyser = audioCtx.createAnalyser();
analyser.fftSize = 512;
const dataArr = new Uint8Array(analyser.frequencyBinCount);

widget.bind(SC.Widget.Events.READY, () => {
  widget.bind(SC.Widget.Events.PLAY, () => {
    const scAudio = new Audio();
    scAudio.crossOrigin = "anonymous";
    widget.getCurrentSound(sound => {
      scAudio.src = sound.stream_url + "?client_id=YOUR_SOUNDCLOUD_CLIENT_ID";
      scAudio.loop = true;
      scAudio.play();
      const source = audioCtx.createMediaElementSource(scAudio);
      source.connect(analyser);
      analyser.connect(audioCtx.destination);
    });
  });
});

// Main render loop
let start = 0;
function render(now) {
  const t = now * 0.001;
  gl.uniform2f(uRes, canvas.width, canvas.height);
  gl.uniform2f(uMouse, mousePos[0], mousePos[1]);
  gl.uniform1f(uTime, t);

  analyser.getByteFrequencyData(dataArr);
  const avg = dataArr.reduce((a,v)=>a+v,0)/dataArr.length/256;
  gl.uniform1f(uAudio, avg);

  gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
  requestAnimationFrame(render);
}
render(0);

// ========== UI & INTERACTIONS ==========

const card = document.getElementById("card");
document.addEventListener("mousemove", e => {
  card.style.transform = `rotateY(${(innerWidth/2 - e.clientX)/30}deg) rotateX(${(innerHeight/2 - e.clientY)/30}deg)`;
});

// Heart cursor trail
document.addEventListener("mousemove", e => {
  const t = document.createElement("div");
  t.className="trail";
  t.innerText="‚ù§Ô∏è";
  t.style.left=e.clientX+"px";
  t.style.top=e.clientY+"px";
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),900);
});

// Runaway No
const noBtn = document.getElementById("noBtn");
document.addEventListener("mousemove", e => {
  const r = noBtn.getBoundingClientRect();
  const dx = e.clientX - (r.left + r.width/2);
  const dy = e.clientY - (r.top + r.height/2);
  const d = Math.hypot(dx,dy);
  if (d < 140) {
    noBtn.style.transform = `translate(${-dx}px,${-dy/2}px)`;
  }
});

// Countdown
const cd = document.getElementById("countdown");
const vday=new Date("February 14, 2026").getTime();
setInterval(()=>{
  const d=vday - Date.now();
  cd.innerHTML = d>0 ?
    `‚è≥ ${Math.floor(d/86400000)}d ${Math.floor(d%86400000/3600000)}h ${Math.floor(d%3600000/60000)}m ${Math.floor(d%60000/1000)}s`
    :"‚ù§Ô∏è It‚Äôs Valentine‚Äôs Day ‚ù§Ô∏è";
},1000);

// Yes
document.getElementById("yesBtn").onclick = ()=>{
  widget.play();
  confetti({particleCount:350, spread:150});
  setTimeout(()=>document.body.innerHTML=
    `<div class="container"><div class="card"><h1>It‚Äôs a DATE ü•∞</h1><p>VALENTINE's DAY is locked ‚ù§Ô∏è ps: Did I nail this right?</p></div></div>`,1100);
};
</script>

</body>
</html>
